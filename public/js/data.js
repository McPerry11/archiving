function loadChips(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"body";$(a).find(".chips[data-name=authors]").chips({placeholder:"Enter an author",secondaryPlaceholder:"+ Author"}),$(a).find(".chips[data-name=keywords]").chips({placeholder:"Enter a keyword",secondaryPlaceholder:"+ Keyword"}),$(a).find(".chips[data-name=category]").chips({placeholder:"Enter a category",secondaryPlaceholder:"+ category"})}function loadTable(){$.ajax({url:main_url+"api/data",dataType:"json",success:function(a){var e=a.role_id,t=a.data;dTable.clear(),$.each(t,function(a,t){t=_.mapObject(t,function(a){return _.escape(a)}),dTable.row.add([t.id,t.title,(t.authors||"").replace(/,/g,"<br>"),(t.keywords||"").replace(/,/g,", "),(t.category||"").replace(/,/g,", "),t.publisher,t.proceeding_date,t.presentation_date,t.publication_date,t.note,(t.file_name?"<button onclick=\"window.open('"+main_url+"public/uploads/"+t.file_name+'\')" class="waves-effect waves-light btn btn-flat">\n                    <i class="material-icons">pageview</i>\n                  </button>':"")+(1==e||e==t.role_id?'\n            <button onclick="editData('+t.id+')" class="waves-effect waves-light btn btn-flat btnEdit">\n              <i class="material-icons">edit</i>\n            </button>\n            <button onclick="deleteData('+t.id+')" class="waves-effect waves-light btn btn-flat btnDelete">\n              <i class="material-icons">delete</i>\n            </button>':"")])}),dTable.draw()}})}function editData(a){var e=$("#editModal");e.find(".loader-container").show(),e.modal("open"),$.ajax({url:main_url+"api/data/"+a,dataType:"json",success:function(t){var n=t.data;loadChips(e),$("select[name=college]").val(n.role_id).formSelect();var i=M.Chips.getInstance(e.find(".chips[data-name=authors]")),o=M.Chips.getInstance(e.find(".chips[data-name=keywords]")),s=M.Chips.getInstance(e.find(".chips[data-name=category]")),l=(n.authors||"").split(","),d=(n.keywords||"").split(","),c=(n.category||"").split(",");$.each(l,function(a,e){i.addChip({tag:e})}),$.each(d,function(a,e){o.addChip({tag:e})}),$.each(c,function(a,e){s.addChip({tag:e})}),e.find("input[name=id]").val(a),e.find("input[name=title]").val(n.title),e.find("input[name=publisher]").val(n.publisher),e.find("input[name=proceeding_date]").val(n.proceeding_date),e.find("input[name=presentation_date]").val(n.presentation_date),e.find("input[name=publication_date]").val(n.publication_date),e.find("input[name=note]").val(n.note),e.find(".loader-container").fadeOut()}})}function deleteData(a){confirm("Are you sure do you want to delete?")&&($(this).prop("disabled",!1),$.ajax({url:main_url+"api/data/"+a,type:"POST",data:{_method:"DELETE"},dataType:"json",success:function(a){a.success?(alert("Deleted Successfully!"),loadTable()):alert(a.error)}}))}$(document).ready(function(){window.dTable=$("#datatable").DataTable({oLanguage:{sStripClasses:"",sSearch:"",sSearchPlaceholder:"Enter Keywords Here",sInfo:"_START_ -_END_ of _TOTAL_",sLengthMenu:'<span>Rows per page:</span><select class="browser-default"><option value="10">10</option><option value="20">20</option><option value="30">30</option><option value="40">40</option><option value="50">50</option><option value="-1">All</option></select></div>'},bAutoWidth:!1,search:{smart:!1},columnDefs:[{targets:[3,6,7,8],visible:!1}]}),loadChips(),loadTable(),$("form[name=frmAdd]").submit(function(a){a.preventDefault(),$(this).find("input").prop("readonly",!0),$(this).find("button").prop("disabled",!0);var e=_.pluck(M.Chips.getInstance($(this).find(".chips[data-name=authors]")).chipsData,"tag"),t=_.pluck(M.Chips.getInstance($(this).find(".chips[data-name=keywords]")).chipsData,"tag"),n=_.pluck(M.Chips.getInstance($(this).find(".chips[data-name=category]")).chipsData,"tag"),i={authors:e.join(","),keywords:t.join(","),category:n.join(",")};$(this).serializeArray().map(function(a){i[a.name]=a.value}),$.ajax({context:this,url:api_url+"data",type:"POST",data:i,dataType:"json",success:function(a){console.log(a),1==a.success?(alert("Added Successfully!"),$(this).trigger("reset"),loadChips("#addModal"),$("#addModal").modal("close"),loadTable()):(console.log(a),alert(a.error))}}).always(function(){$(this).find("input").prop("readonly",!1),$(this).find("button").prop("disabled",!1)})}),$("form[name=frmEdit]").submit(function(a){a.preventDefault(),$(this).find("input").prop("readonly",!0),$(this).find("button").prop("disabled",!0);var e=_.pluck(M.Chips.getInstance($(this).find(".chips[data-name=authors]")).chipsData,"tag"),t=_.pluck(M.Chips.getInstance($(this).find(".chips[data-name=keywords]")).chipsData,"tag"),n=_.pluck(M.Chips.getInstance($(this).find(".chips[data-name=category]")).chipsData,"tag"),i={authors:e.join(","),keywords:t.join(","),category:n.join(",")};$(this).serializeArray().map(function(a){i[a.name]=a.value});var o=new FormData;$.each(i,function(a,e){o.append(a,e)}),$(this).find("input[name=file]").val()&&o.append("file",$(this).find("input[name=file]").prop("files")[0]),o.append("_method","PUT"),$.ajax({context:this,url:api_url+"data/"+$(this).find("input[name=id]").val(),type:"POST",data:o,contentType:!1,processData:!1,dataType:"json",success:function(a){console.log(a),1==a.success?(alert("Updated Successfully!"),$("#editModal").modal("close"),$(this).trigger("reset"),loadTable()):(console.log(a),alert(a.error))}}).always(function(){$(this).find("input").prop("readonly",!1),$(this).find("button").prop("disabled",!1)})}),$(".btnUpload").click(function(){$("input[name=uploadExcel]").trigger("click")}),$("input[name=uploadExcel]").change(function(){if(confirm("Are you sure do you want to upload?")){var a=new FormData;a.append("file",$(this).prop("files")[0]),$.ajax({url:api_url+"data/upload",type:"POST",data:a,dataType:"json",contentType:!1,processData:!1,success:function(a){1==a.success?(alert("Uploaded Successfully!"),loadTable()):(console.log(a),alert(a.error))}})}})}),$(".generate-pdf").click(function(){$("input[name=search]").val()&&$("input[name=data]").val(JSON.stringify(Object.values(dTable.rows({filter:"applied"}).data()))),$("input[name=data]").closest("form").trigger("submit")});
